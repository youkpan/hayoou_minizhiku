var BxMsgInvitationHeight=300;var BxMsgInviteInterval;var sBxMsgTemplate="";var aBxMsgMessages=new Array();var aBxMsgInvitations=new Object();function BxMsgUpdate(){var a=new Date();$.get(sBxMsgUpdateUrl,{_t:a.getTime()},function(b){var d=b.getElementsByTagName("msg");for(var c=0;c<d.length;c++){aBxMsgMessages.push({sender:d[c].getAttribute("sender"),nick:d[c].getAttribute("nick"),profile:d[c].getAttribute("profile"),text:d[c].firstChild.nodeValue})}if(aBxMsgMessages.length){BxMsgShowInvitations()}},"xml");BxMsgInviteInterval=setTimeout("BxMsgUpdate();",BxMsgUpdateInterval)}function BxMsgShowInvitations(){if(sBxMsgTemplate.length){for(var a=0;a<aBxMsgMessages.length;a++){BxMsgShowInvitation(aBxMsgMessages[a])}aBxMsgMessages.length=0}else{$.get(sBxMsgGetUrl+"get_invitation",{},function(b){sBxMsgTemplate=$.trim(b);BxMsgShowInvitations()},"html")}}function BxMsgShowInvitation(b){if(aBxMsgInvitations[b.sender]){return}var a=sBxMsgTemplate.split("__sender_id__").join(b.sender);a=a.split("__sender_nickname__").join(b.nick);a=a.split("__sender_profile__").join(b.profile);a=a.split("__invitation_text__").join(b.text);$.get(sBxMsgGetUrl+"get_thumbnail/"+b.sender,{},function(c){a=a.split("__sender_thumbnail__").join($.trim(c));aBxMsgInvitations[b.sender]=$(a).prependTo("body");BxMsgRefreshPositions()},"html")}function BxMsgRemoveInvitation(a){aBxMsgInvitations[a].remove();aBxMsgInvitations[a]=null;BxMsgRefreshPositions()}function BxMsgRefreshPositions(){var a=0;for(var b in aBxMsgInvitations){if(aBxMsgInvitations[b]==null){continue}aBxMsgInvitations[b].attr("style","top:"+(BxMsgTopMargin+a*BxMsgInvitationHeight)+"px");a++}}function BxMsgPerformAction(b,a){switch(a){case"accept":openRayWidget("im","user",sBxMsgMemberId,sBxMsgMemberPassword,b);break;case"spam":case"block":$.post(sBxMsgSiteUrl+"list_pop.php?action="+a,{ID:b});break;case"decline":default:break}BxMsgRemoveInvitation(b)};
