if(typeof tdebug=="undefined"){tdebug=0}if(!tdebug){console.log=function(a){}}if($(".wall-event").length>0){first_tl_id=$(".wall-event")[0].id;tl_timmer=Array();tl_timmer_sum=Array();tl_id=Array();tl_mouse_over=Array();tl_like=Array();tl_cmt=Array();tl_click=Array();tl_repost=Array();var last_ws_top=$(window).scrollTop();function clear_viewing(a){if(0<tl_timmer[a]){if(tdebug){tl_div[a].style.backgroundColor="#fff"}if(!tl_timmer_sum[a]>0){tl_timmer_sum[a]=0}tl_timmer_sum[a]+=new Date().getTime()-tl_timmer[a];tl_timmer[a]=0;return true}return false}function clear_other(a){if(tl_timmer[a]==0){return false}tl_div=$(".wall-event");for(i=0;i<tl_div.length;i++){if(i==a){continue}clear_viewing(i)}return true}function mouse_over(){clear_other(this.tl_i);if(tdebug){tl_div[this.tl_i].style.backgroundColor="#ddd"}tl_timmer[this.tl_i]=new Date().getTime()}function on_click(){did=tl_id[$(this).tl_i];tl_click.push(did)}function on_like(){did=$(this).parent().parent()[0].id.replace(/.*\-(\d)/,"$1");tl_like.push(did)}function on_comment(){did=$(this).parent().parent()[0].id.replace(/.*\-(\d)/,"$1");tl_cmt.push(did)}function on_repost(){did=$(this).parent().parent()[0].id.replace(/.*\-(\d)/,"$1");tl_repost.push(did)}last_tl_cnt=0;setInterval(function(){if(last_tl_cnt==$(".wall-event").length){return}vote_div=$(".wall-voting");$(vote_div).on("mouseup",on_like);cmt_div=$(".cmt-reply-toggle");$(cmt_div).on("mouseup",on_comment);repost_div=$(".wall-repost");$(repost_div).on("mouseup",on_repost);last_tl_cnt=$(".wall-event").length},2000);$(window).scroll(function(){tl_div=$(".wall-event");if(first_tl_id!=tl_div[0].id){upload_timeline_data();sessionStorage.needupload=0}wheight=$(window).height();ws_top=$(window).scrollTop();for(i=0;i<tl_div.length;i++){tl_div[i].tl_i=i;if(!ismobile){$(tl_div[i]).on("mouseover",mouse_over)}$(tl_div[i]).on("click",on_click);bb=tl_div[i];idd=tl_div[i].id.replace("wall-event-","");tl_id[i]=idd;var b=$(bb).offset().top;if(b<10){continue}var a=b+bb.offsetHeight;var c=0;if(bb.offsetHeight>(wheight-85)*0.7){a=b+(wheight-85)*0.7;c=1}ws_clear_top=ws_top+44;if(ismobile){ws_clear_top=ws_top}if((c==0&&b>=ws_clear_top&&b<=ws_top+wheight*0.6||c==1&&b>=ws_top-bb.offsetHeight+wheight*0.3)&&a<ws_top+wheight-41){if(typeof tl_timmer[i]=="undefined"||"NaN"==tl_timmer[i]||tl_timmer[i]==0){if(tdebug){tl_div[i].style.backgroundColor="#ddd";console.log("div: "+i+" is viewing")}tl_timmer[i]=new Date().getTime()}}else{if(clear_viewing(i)){}}}last_ws_top=ws_top});oid=0;setInterval(upload_timeline_data,20000);$(window).bind("beforeunload",function(){sessionStorage.tl_timmer_sum=tl_timmer_sum;sessionStorage.tl_id=tl_id;sessionStorage.needupload=1})}function upload_timeline_data(){date1=new Date().getTime();var a=tl_timmer_sum;if(tl_like.length||tl_cmt.length||tl_click.length||tl_repost.length){}else{needsend=0;for(i=0;i<a.length;i++){if(a[i]>0){needsend=1}}if(!needsend){return}}tmp_tl_id=Array();a=Array();for(i=0;i<tl_timmer_sum.length;i++){if(typeof tl_timmer_sum[i]!="undefined"){if(tl_timmer_sum[i]>0){tmp_tl_id.push(tl_id[i]);a.push(tl_timmer_sum[i])}}}$.post("http://f.hayoou.com/timline/updata.php",{date:date1,oid:oid,tl_id:tmp_tl_id,timmer:a,tl_like:tl_like,tl_cmt:tl_cmt,tl_click:tl_click,tl_repost:tl_repost},function(b){console.log("upload_timeline_data")});tl_timmer_sum=Array();tl_id=Array();tl_like=Array();tl_cmt=Array();tl_click=Array();tl_repost=Array()}if(1==sessionStorage.needupload){tl_timmer_sum=sessionStorage.tl_timmer_sum.split(/,/);tl_id=sessionStorage.tl_id.split(/,/);sessionStorage.needupload=0;upload_timeline_data()}function _EC(a){return document.getElementsByClassName(a)}function _EI(a){return document.getElementById(a)}ismobile=0;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){ismobile=1}if(ismobile==0){}wallout=$("#bx-wall-outline .wall-outline-items");if(wallout.length>0&&ismobile==0){document.getElementById("bx-wall-outline").style.margin="0";wallout_itm=0;setInterval(function(){if(wallout_itm!=$(".wall-oi-item").length){$(".wall-oi-item").css("width","236px");$(".wall-oi-item").css("margin","7px 7px 0 7px");$(".wall-oi-item").css("width","236px");$(".wall-oi-item").css("margin","7px 7px 0 7px");$("div.wall-oi-sizer").css("width","236px");wallout.masonry({itemSelector:".wall-oi-item",columnWidth:251,gutterWidth:7})}wallout_itm=$(".wall-oi-item").length},500)}aa=document.getElementsByClassName("top_link");for(i=0;i<aa.length;i++){aa[i].style.fontSize="19px";aa[i].style.fontWeight="bold";aa[i].style.fontFamily="微软雅黑"}function fix_timeline(){$(".bx-def-font-h2").css("font-size","17px");aa=$(".bx-twig-unit-line.bx-twig-unit-desc");for(i=0;i<aa.length;i++){aa[i].innerHTML=aa[i].innerHTML.substring(0,100)}if($("#page_block_932").length==0){aa=$(".bx-def-bc-margin");aa.css("margin","0")}aa=$(".wall-event-cnt");aa.css("margin","0 0 0 42px");aa=$(".bx-def-thumbnail.bx-def-shadow");aa.css("width","32px");aa.css("height","32px");aa.css("line-height","32px");aa.css("font-size","21px");aa=$(".thumbnail_image");aa.css("width","32px");aa.css("height","32px");aa=$(".thumbnail_block");aa.css("width","32px");aa.css("height","32px")}function get_wall_items(){if(0!=$(".wall-event").length){return $(".wall-event").length}else{return $(".wall-oi-item").length}}if(ismobile&&$(".quickLinksBlock.bx-def-bc-margin-thd").length>0){$("#page_column_1").css("display","none")}if(ismobile){$(".sys_mc_wrapper.bx-def-margin-sec-leftright").css("margin","0");$(".dbContent.bx-def-bc-margin").css("margin","0")}timeline_itm=0;get_new=0;timeline_start_itm=0;setInterval(function(){if(timeline_itm!=get_wall_items()){if(0!=$(".wall-event").length){if(ismobile){fix_timeline()}}else{bb=$(".wall-oii-description.bx_blogs-wall-oii-description.bx-def-font-small.bx-def-font-grayed");for(i=0;i<bb.length;i++){bb[i].innerHTML=bb[i].innerHTML.substring(0,100)}$(".wall-oi-item").css("width","236px")}timeline_itm=get_wall_items();get_new=1;$("div.wall-divider-cnt").css("width","80px")}if(get_new&&document.getElementById("wall-load-more")){var b=document.getElementById("wall-load-more").offsetTop;if(b>=$(window).scrollTop()&&b<$(window).scrollTop()+$(window).height()+400){if(0!=$(".wall-event").length){oWallView.changePage(timeline_itm+timeline_start_itm,20)}else{if(0!=$(".wall-oi-item").length){oWallOutline.changePage(timeline_itm,40)}}get_new=0}}},200);
